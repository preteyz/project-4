{% extends 'base.html' %}

{% block content %}
{% comment %} <div>
    <img src="{{location.img}}" alt="picture of {{location.name}}"/>
</div> {% endcomment %}
<div>
    <h3>Name: {{ location.name }}</h3>
    <img src="{{location.img}}" alt="{{location.name}}">
    <p>Created by:
        <a href="/user/{{ location.user.username }}">{{ location.user.username }}</a>
    </p> 
    <div>
        <a href="{% url 'location_update' location.pk %}">Update</a>
        <a href="{% url 'location_delete' location.pk %}">Delete</a>
    </div>

    <br/><br/>
    
    <form action="{% url 'favorite_location' location.pk %}" method="POST">
        {% csrf_token %}
        
        {% if user.is_authenticated %}
            {% if faved %}
                <button type="submit", name="location_id", value="{{ location.id }}", class="btn btn-danger btn-sm">Unfav</button> - {{total_faves}} 
                <!-- Button trigger modal -->
                <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#staticBackdrop">
                    Favorites
                </button>
                
                <!-- Modal -->
                <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
                    <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                        <h5 class="modal-title" id="staticBackdropLabel">Users who have favorited this location</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            {% for user in favorites.all %}
                                <a href="/user/{{ user.username }}">{{ user.username }}</a>
                                {% empty %}
                                <div> This location has no favorites...</div>
                            {% endfor %}
                        </div>
                        <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        </div>
                    </div>
                    </div>
                </div>
            {% else %}
            <button type="submit", name="location_id", value="{{ location.id }}", class="btn btn-primary btn-sm">Fav</button> - {{total_faves}} Favorites
            {% endif %}
        {% else %}
        <small> - Must be logged in to favorite </small>
        {% endif %}
    </form>
    <br/>

    <h3>Reviews:</h3>
    {% for review in reviews.all %}
        {% if review.travel_location.id == location.id %}
        <div>{{ review.user.username }}</div>
        <div>{{ review.created_at }}</div>
        <div>{{ review.name }}</div>
        <div>{{ review.body }}</div>
        {% endif %}
        
        {% empty %}
        <div> This location has no reviews...</div>
    {% endfor %}
    <a href="{% url 'review_create' location.pk %}">Add review</a>
</div>



{% endblock %}